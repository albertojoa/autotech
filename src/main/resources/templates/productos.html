<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Gesti贸n de Productos - Autotech Garage</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .stock-bajo {
            background-color: #ffe5e5;
            color: #b30000;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="brand">
                <img th:src="@{/images/logo.jpg}" alt="Autotech Garage Logo" class="logo">
                <h1>Autotech Garage</h1>
            </div>
            <nav class="menu">
                <a th:href="@{/clientes}">Clientes</a>
                <a th:href="@{/proveedores}">Proveedores</a>
                <a th:href="@{/productos}">Productos</a>
                <a th:href="@{/ventas}">Ventas</a>
                <a th:href="@{/compras}">Compras</a>
                <a th:href="@{/reportes}">Reportes</a>
                <a th:href="@{/usuarios}">Usuarios</a>
                <a th:href="@{/roles}">Roles</a>
                <a th:href="@{/configuracion}">Configuraci贸n</a>
                <a th:href="@{/ayuda}">Ayuda</a>
                <a th:href="@{/dashboard}">Inicio</a>
            </nav>
        </div>
    </header>

    <main class="page">
        <div class="container">
            <h2>Gesti贸n de Productos</h2>

            <div class="actions-top">
                <a class="btn btn-primary" th:href="@{/productos/nuevo}">Nuevo Producto</a>
                <a href="#stock-bajo" class="btn btn-secondary">Ver productos con bajo stock</a>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Descripci贸n</th>
                        <th>Stock</th>
                        <th>Precio Unitario</th>
                        <th>Categor铆a</th>
                        <th>Marca</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:if="${productos.isEmpty()}">
                        <td colspan="8">No hay productos registrados</td>
                    </tr>
                    <tr th:each="producto : ${productos}" th:classappend="${producto.stock != null && producto.stock <= 5} ? 'stock-bajo'">
                        <td th:text="${producto.id}"></td>
                        <td th:text="${producto.nombre}"></td>
                        <td th:text="${producto.descripcion}"></td>
                        <td th:text="${producto.stock}"></td>
                        <td th:text="${producto.precioUnitario != null ? #numbers.formatDecimal(producto.precioUnitario,1,'POINT',2,'POINT') : '0.00'}"></td>
                        <td th:text="${producto.categoria}"></td>
                        <td th:text="${producto.marca}"></td>
                        <td>
                            <a class="btn btn-secondary" th:href="@{|/productos/${producto.id}/editar|}">Editar</a>
                            <form th:action="@{|/productos/${producto.id}/eliminar|}" method="post" style="display:inline;">
                                <button class="btn btn-secondary" type="submit">Eliminar</button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="actions-bottom">
                <a class="btn btn-secondary" th:href="@{/dashboard}">Volver</a>
            </div>

            <h2 id="stock-bajo"> Productos con Bajo Stock</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Stock Actual</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:if="${productosBajoStock.isEmpty()}">
                        <td colspan="4">No hay productos con stock bajo</td>
                    </tr>
                    <tr th:each="producto : ${productosBajoStock}" class="stock-bajo">
                        <td th:text="${producto.id}"></td>
                        <td th:text="${producto.nombre}"></td>
                        <td th:text="${producto.stock}"></td>
                        <td>Por debajo del m铆nimo</td>
                    </tr>
                </tbody>
            </table>

        </div>
    </main>
</body>
</html>
